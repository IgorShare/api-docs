machine:
  ruby:
    version: 2.3.1
test:
  post:
    - bundle exec middleman build

deployment:
  s3website:
    branch: feature/s3_deploy
    commands:
      - export DEPLOYMENT_TARGET=production
      - bundle install
      - bundle exec middleman build
      - DEPLOYMENT_TARGET=production bundle exec s3_website push
  legacy:
    branch: legacy
    commands:
      - export DEPLOYMENT_TARGET=legacy
      - bundle install
      - bundle exec middleman build
      - bundle exec s3_website push
  production:
    branch: master
    commands:
      - sudo pip install awscli
      - aws s3 cp build/ s3://librato-api/ --recursive
